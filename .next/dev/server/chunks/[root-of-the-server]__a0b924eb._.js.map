{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/duwa/Git/webui-devops/Naratel-Devops-Dashboard/src/lib/argocd.js"],"sourcesContent":["// src/lib/argocd.js\n\n// Cache token in memory to avoid frequent logins\nlet cachedToken = null;\nlet tokenExpiry = 0;\n\n/**\n * Mendapatkan Authentication Token dari ArgoCD\n */\nasync function getAuthToken() {\n  const now = Date.now();\n  \n  if (cachedToken && now < tokenExpiry) {\n    return cachedToken;\n  }\n\n  const baseUrl = process.env.ARGOCD_URL?.replace(/\\/$/, '');\n  const password = process.env.ARGOCD_ADMIN_PASSWORD;\n  const username = process.env.ARGOCD_USERNAME || 'admin';\n\n  if (!baseUrl || !password) {\n    console.error(\"[ArgoCD] Missing configuration\");\n    return null;\n  }\n\n  try {\n    console.log(`[ArgoCD] Attempting login to ${baseUrl}...`);\n    const res = await fetch(`${baseUrl}/api/v1/session`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ username, password }),\n      signal: AbortSignal.timeout(10000), \n    });\n\n    if (!res.ok) {\n      const errBody = await res.text();\n      console.error(`[ArgoCD] Auth failed (${res.status}): ${errBody}`);\n      return null;\n    }\n\n    const data = await res.json();\n    cachedToken = data.token;\n    tokenExpiry = now + (60 * 60 * 1000); \n    console.log(\"[ArgoCD] Login successful, token cached.\");\n    return cachedToken;\n  } catch (error) {\n    console.error(\"[ArgoCD] Connection Error:\", error.message);\n    return null;\n  }\n}\n\n/**\n * Mengambil Status Aplikasi dari ArgoCD\n * @param {string} appName Nama aplikasi di ArgoCD (misal: myapp-prod)\n */\nexport async function getArgoAppStatus(appName) {\n  const token = await getAuthToken();\n  const baseUrl = process.env.ARGOCD_URL?.replace(/\\/$/, '');\n\n  if (!token) return { error: \"Authentication failed. Check logs.\" };\n\n  try {\n    const res = await fetch(`${baseUrl}/api/v1/applications/${appName}`, {\n      method: 'GET',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      next: { revalidate: 0 }\n    });\n\n    if (res.status === 404) {\n      return { status: 'NotFound', error: `Application ${appName} not found in ArgoCD` };\n    }\n\n    if (!res.ok) {\n      const errText = await res.text();\n      throw new Error(`ArgoCD API Error (${res.status}): ${errText}`);\n    }\n\n    const data = await res.json();\n    \n    return {\n      health: data.status?.health?.status || 'Unknown',\n      sync: data.status?.sync?.status || 'Unknown',\n      operation: data.status?.operationState?.phase || null,\n      conditions: data.status?.conditions || []\n    };\n\n  } catch (error) {\n    console.error(`[ArgoCD] Fetch Error for ${appName}:`, error.message);\n    return { error: error.message };\n  }\n}\n"],"names":[],"mappings":"AAAA,oBAAoB;AAEpB,iDAAiD;;;;;AACjD,IAAI,cAAc;AAClB,IAAI,cAAc;AAElB;;CAEC,GACD,eAAe;IACb,MAAM,MAAM,KAAK,GAAG;IAEpB,IAAI,eAAe,MAAM,aAAa;QACpC,OAAO;IACT;IAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,UAAU,EAAE,QAAQ,OAAO;IACvD,MAAM,WAAW,QAAQ,GAAG,CAAC,qBAAqB;IAClD,MAAM,WAAW,QAAQ,GAAG,CAAC,eAAe,IAAI;IAEhD,IAAI,CAAC,WAAW,CAAC,UAAU;QACzB,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IAEA,IAAI;QACF,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,QAAQ,GAAG,CAAC;QACxD,MAAM,MAAM,MAAM,MAAM,GAAG,QAAQ,eAAe,CAAC,EAAE;YACnD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAU;YAAS;YAC1C,QAAQ,YAAY,OAAO,CAAC;QAC9B;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,UAAU,MAAM,IAAI,IAAI;YAC9B,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,IAAI,MAAM,CAAC,GAAG,EAAE,SAAS;YAChE,OAAO;QACT;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,cAAc,KAAK,KAAK;QACxB,cAAc,MAAO,KAAK,KAAK;QAC/B,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B,MAAM,OAAO;QACzD,OAAO;IACT;AACF;AAMO,eAAe,iBAAiB,OAAO;IAC5C,MAAM,QAAQ,MAAM;IACpB,MAAM,UAAU,QAAQ,GAAG,CAAC,UAAU,EAAE,QAAQ,OAAO;IAEvD,IAAI,CAAC,OAAO,OAAO;QAAE,OAAO;IAAqC;IAEjE,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,GAAG,QAAQ,qBAAqB,EAAE,SAAS,EAAE;YACnE,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;YACpC;YACA,MAAM;gBAAE,YAAY;YAAE;QACxB;QAEA,IAAI,IAAI,MAAM,KAAK,KAAK;YACtB,OAAO;gBAAE,QAAQ;gBAAY,OAAO,CAAC,YAAY,EAAE,QAAQ,oBAAoB,CAAC;YAAC;QACnF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,UAAU,MAAM,IAAI,IAAI;YAC9B,MAAM,IAAI,MAAM,CAAC,kBAAkB,EAAE,IAAI,MAAM,CAAC,GAAG,EAAE,SAAS;QAChE;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,OAAO;YACL,QAAQ,KAAK,MAAM,EAAE,QAAQ,UAAU;YACvC,MAAM,KAAK,MAAM,EAAE,MAAM,UAAU;YACnC,WAAW,KAAK,MAAM,EAAE,gBAAgB,SAAS;YACjD,YAAY,KAAK,MAAM,EAAE,cAAc,EAAE;QAC3C;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,yBAAyB,EAAE,QAAQ,CAAC,CAAC,EAAE,MAAM,OAAO;QACnE,OAAO;YAAE,OAAO,MAAM,OAAO;QAAC;IAChC;AACF"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///home/duwa/Git/webui-devops/Naratel-Devops-Dashboard/src/app/api/manifest/argo-status/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getArgoAppStatus } from '@/lib/argocd';\n\nexport const dynamic = 'force-dynamic'; // Disable caching\n\nexport async function GET(request) {\n  const { searchParams } = new URL(request.url);\n  const appName = searchParams.get('appName');\n\n  if (!appName) {\n    return NextResponse.json({ error: 'App Name is required' }, { status: 400 });\n  }\n\n  // Jika env variable belum diset, return mock data untuk development agar UI tidak rusak\n  if (!process.env.ARGOCD_URL) {\n      // Mock random delay response\n      return NextResponse.json({\n          health: 'MissingConfig', // Indikator khusus\n          sync: 'Unknown'\n      });\n  }\n\n  try {\n    const status = await getArgoAppStatus(appName);\n    return NextResponse.json(status);\n  } catch (error) {\n    return NextResponse.json({ error: error.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU,iBAAiB,kBAAkB;AAEnD,eAAe,IAAI,OAAO;IAC/B,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,UAAU,aAAa,GAAG,CAAC;IAEjC,IAAI,CAAC,SAAS;QACZ,OAAO,qMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;IAEA,wFAAwF;IACxF,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE;QACzB,6BAA6B;QAC7B,OAAO,qMAAY,CAAC,IAAI,CAAC;YACrB,QAAQ;YACR,MAAM;QACV;IACJ;IAEA,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,+LAAgB,EAAC;QACtC,OAAO,qMAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO,qMAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}