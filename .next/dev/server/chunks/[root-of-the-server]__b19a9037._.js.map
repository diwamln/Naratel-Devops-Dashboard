{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///home/duwa/Git/fix/Naratel-Devops-Dashboard/src/lib/gitMutex.js"],"sourcesContent":["import { Mutex } from 'async-mutex';\n\n// Shared mutex instance to prevent race conditions during Git operations\nexport const gitMutex = new Mutex();\n"],"names":[],"mappings":";;;;AAAA;;AAGO,MAAM,WAAW,IAAI,4LAAK"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///home/duwa/Git/fix/Naratel-Devops-Dashboard/src/lib/jenkins.js"],"sourcesContent":["/**\n * Jenkins API Helper Library\n * Provides functions to manage Jenkins Pipeline jobs programmatically\n */\n\nconst JENKINS_URL = process.env.JENKINS_URL;\nconst JENKINS_USER = process.env.JENKINS_USER;\nconst JENKINS_API_TOKEN = process.env.JENKINS_API_TOKEN;\n\n/**\n * Get Base64 encoded auth header for Jenkins\n */\nfunction getAuthHeader() {\n    const credentials = Buffer.from(`${JENKINS_USER}:${JENKINS_API_TOKEN}`).toString('base64');\n    return `Basic ${credentials}`;\n}\n\n/**\n * Generate Jenkinsfile content from template\n * @param {Object} params - Pipeline parameters\n * @param {string} params.appName - Application name\n * @param {string} params.imageRepo - Docker image repository\n * @param {string} params.gitRepoUrl - Git repository URL for the app source code\n * @param {string} params.webuiUrl - WebUI API base URL\n */\nfunction generateJenkinsfile({ appName, imageRepo, gitRepoUrl, webuiUrl }) {\n    return `pipeline {\n    agent any\n\n    environment {\n        APP_NAME       = \"${appName}\"\n        DOCKER_IMAGE   = \"${imageRepo}\"\n        DOCKER_CRED_ID = \"docker-hub\"\n\n        // URL WebUI Base\n        WEBUI_API      = \"${webuiUrl}\"\n        \n        APP_VERSION    = \"\"\n    }\n\n    stages {\n        stage('Checkout & Get Version') {\n            steps {\n                script {\n                    checkout scm\n                    APP_VERSION = sh(\n                        script: \"git describe --tags --always --abbrev=0 || echo \\${BUILD_NUMBER}\",\n                        returnStdout: true\n                    ).trim()\n                    echo \"Building Version: \\${APP_VERSION}\"\n                }\n            }\n        }\n\n        stage('Build & Push Docker') {\n            steps {\n                script {\n                    docker.withRegistry('', \"\\${DOCKER_CRED_ID}\") {\n                        def customImage = docker.build(\"\\${DOCKER_IMAGE}:\\${APP_VERSION}\")\n                        customImage.push()\n                        customImage.push(\"latest\")\n                    }\n                }\n            }\n        }\n\n        stage('Deploy Testing (Ephemeral)') {\n            steps {\n                script {\n                    echo \"Triggering WebUI to create Ephemeral Testing Environment...\"\n                    def response = sh(script: \"\"\"\n                        curl -s -X POST \\${WEBUI_API}/api/jenkins/deploy-test \\\\\n                        -H \"Content-Type: application/json\" \\\\\n                        -d '{\"appName\": \"\\${APP_NAME}\", \"imageTag\": \"\\${APP_VERSION}\"}'\n                    \"\"\", returnStdout: true).trim()\n\n                    echo \"WebUI Response: \\${response}\"\n\n                    if (response.contains('\"error\"')) {\n                        error \"Failed to deploy testing env: \\${response}\"\n                    }\n\n                    echo \"Waiting for pods to be ready...\"\n                    sleep 60\n                }\n            }\n        }\n\n        stage('Integration Tests') {\n            steps {\n                script {\n                    echo \"Running Tests against Testing Env...\"\n                }\n            }\n        }\n\n        stage('Approval for Production') {\n            steps {\n                script {\n                    try {\n                        input message: \"Testing Done. Approve deploy \\${APP_VERSION} to Production?\",\n                              id: 'ApproveDeploy'\n                    } catch (Exception e) {\n                        currentBuild.result = 'ABORTED'\n                        error \"Deployment to Production Cancelled.\"\n                    }\n                }\n            }\n        }\n\n        stage('Deploy to Production') {\n            steps {\n                script {\n                    echo \"Updating Production Image Version...\"\n                    def response = sh(script: \"\"\"\n                        curl -s -X POST \\${WEBUI_API}/api/manifest/update-image \\\\\n                        -H \"Content-Type: application/json\" \\\\\n                        -d '{\"appName\": \"\\${APP_NAME}\", \"env\": \"prod\", \"imageTag\": \"\\${APP_VERSION}\"}'\n                    \"\"\", returnStdout: true).trim()\n\n                    echo \"WebUI Response: \\${response}\"\n\n                    if (response.contains('\"error\"')) {\n                        error \"Failed to update production: \\${response}\"\n                    }\n                }\n            }\n        }\n    }\n\n    post {\n        always {\n            script {\n                echo \"Cleaning up Ephemeral Testing Environment...\"\n                sh \"\"\"\n                    curl -s -X POST \\${WEBUI_API}/api/jenkins/destroy-test \\\\\n                    -H \"Content-Type: application/json\" \\\\\n                    -d '{\"appName\": \"\\${APP_NAME}\"}'\n                \"\"\"\n                cleanWs()\n            }\n        }\n    }\n}`;\n}\n\n/**\n * Generate Jenkins Pipeline Job XML config\n */\nfunction generateJobConfigXml({ appName, imageRepo, gitRepoUrl, webuiUrl }) {\n    const jenkinsfileContent = generateJenkinsfile({ appName, imageRepo, gitRepoUrl, webuiUrl });\n\n    // Escape XML special characters in Jenkinsfile\n    const escapedJenkinsfile = jenkinsfileContent\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&apos;');\n\n    return `<?xml version='1.1' encoding='UTF-8'?>\n<flow-definition plugin=\"workflow-job\">\n  <description>CI/CD Pipeline for ${appName} - Auto-generated by Naratel DevOps Dashboard</description>\n  <keepDependencies>false</keepDependencies>\n  <properties>\n    <org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>\n      <triggers/>\n    </org.jenkinsci.plugins.workflow.job.properties.PipelineTriggersJobProperty>\n  </properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition\" plugin=\"workflow-cps\">\n    <scm class=\"hudson.plugins.git.GitSCM\" plugin=\"git\">\n      <configVersion>2</configVersion>\n      <userRemoteConfigs>\n        <hudson.plugins.git.UserRemoteConfig>\n          <url>${gitRepoUrl}</url>\n          <credentialsId>git-token</credentialsId>\n        </hudson.plugins.git.UserRemoteConfig>\n      </userRemoteConfigs>\n      <branches>\n        <hudson.plugins.git.BranchSpec>\n          <name>*/main</name>\n        </hudson.plugins.git.BranchSpec>\n      </branches>\n      <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>\n      <submoduleCfg class=\"empty-list\"/>\n      <extensions/>\n    </scm>\n    <scriptPath>Jenkinsfile</scriptPath>\n    <lightweight>true</lightweight>\n  </definition>\n  <triggers/>\n  <disabled>false</disabled>\n</flow-definition>`;\n}\n\n/**\n * Check if a Jenkins job exists\n * @param {string} jobName - Name of the job to check\n * @returns {Promise<boolean>}\n */\nexport async function jobExists(jobName) {\n    if (!JENKINS_URL || !JENKINS_USER || !JENKINS_API_TOKEN) {\n        console.warn('[Jenkins] Missing configuration, skipping job check');\n        return false;\n    }\n\n    try {\n        const response = await fetch(`${JENKINS_URL}/job/${encodeURIComponent(jobName)}/api/json`, {\n            method: 'GET',\n            headers: {\n                'Authorization': getAuthHeader(),\n            },\n        });\n        return response.ok;\n    } catch (error) {\n        console.error('[Jenkins] Error checking job:', error.message);\n        return false;\n    }\n}\n\n/**\n * Create a new Jenkins Pipeline job\n * @param {Object} params - Job parameters\n * @param {string} params.appName - Application name (used as job name)\n * @param {string} params.imageRepo - Docker image repository\n * @param {string} params.gitRepoUrl - Git repository URL\n * @returns {Promise<{success: boolean, message: string}>}\n */\nexport async function createPipelineJob({ appName, imageRepo, gitRepoUrl }) {\n    if (!JENKINS_URL || !JENKINS_USER || !JENKINS_API_TOKEN) {\n        console.warn('[Jenkins] Missing configuration, skipping job creation');\n        return { success: false, message: 'Jenkins not configured' };\n    }\n\n    const jobName = appName;\n    const webuiUrl = process.env.NEXT_PUBLIC_APP_URL || process.env.NEXTAUTH_URL || 'http://localhost:3000';\n\n    // Check if job already exists\n    const exists = await jobExists(jobName);\n    if (exists) {\n        console.log(`[Jenkins] Job '${jobName}' already exists, skipping creation`);\n        return { success: true, message: `Job '${jobName}' already exists` };\n    }\n\n    const jobXml = generateJobConfigXml({ appName, imageRepo, gitRepoUrl, webuiUrl });\n\n    try {\n        // First, get crumb for CSRF protection\n        let crumb = null;\n        try {\n            const crumbResponse = await fetch(`${JENKINS_URL}/crumbIssuer/api/json`, {\n                method: 'GET',\n                headers: {\n                    'Authorization': getAuthHeader(),\n                },\n            });\n            if (crumbResponse.ok) {\n                const crumbData = await crumbResponse.json();\n                crumb = crumbData;\n            }\n        } catch (e) {\n            console.log('[Jenkins] Crumb issuer not available, proceeding without CSRF token');\n        }\n\n        // Create the job\n        const headers = {\n            'Authorization': getAuthHeader(),\n            'Content-Type': 'application/xml',\n        };\n\n        if (crumb) {\n            headers[crumb.crumbRequestField] = crumb.crumb;\n        }\n\n        const response = await fetch(`${JENKINS_URL}/createItem?name=${encodeURIComponent(jobName)}`, {\n            method: 'POST',\n            headers,\n            body: jobXml,\n        });\n\n        if (response.ok) {\n            console.log(`[Jenkins] Successfully created job '${jobName}'`);\n            return { success: true, message: `Jenkins job '${jobName}' created successfully` };\n        } else {\n            const errorText = await response.text();\n            console.error(`[Jenkins] Failed to create job: ${response.status}`, errorText);\n            return { success: false, message: `Failed to create Jenkins job: ${response.status}` };\n        }\n    } catch (error) {\n        console.error('[Jenkins] Error creating job:', error.message);\n        return { success: false, message: `Jenkins error: ${error.message}` };\n    }\n}\n\n/**\n * Delete a Jenkins job\n * @param {string} jobName - Name of the job to delete\n * @returns {Promise<{success: boolean, message: string}>}\n */\nexport async function deleteJob(jobName) {\n    if (!JENKINS_URL || !JENKINS_USER || !JENKINS_API_TOKEN) {\n        console.warn('[Jenkins] Missing configuration, skipping job deletion');\n        return { success: false, message: 'Jenkins not configured' };\n    }\n\n    // Check if job exists\n    const exists = await jobExists(jobName);\n    if (!exists) {\n        console.log(`[Jenkins] Job '${jobName}' does not exist, skipping deletion`);\n        return { success: true, message: `Job '${jobName}' does not exist` };\n    }\n\n    try {\n        // Get crumb for CSRF protection\n        let crumb = null;\n        try {\n            const crumbResponse = await fetch(`${JENKINS_URL}/crumbIssuer/api/json`, {\n                method: 'GET',\n                headers: {\n                    'Authorization': getAuthHeader(),\n                },\n            });\n            if (crumbResponse.ok) {\n                const crumbData = await crumbResponse.json();\n                crumb = crumbData;\n            }\n        } catch (e) {\n            console.log('[Jenkins] Crumb issuer not available');\n        }\n\n        const headers = {\n            'Authorization': getAuthHeader(),\n        };\n\n        if (crumb) {\n            headers[crumb.crumbRequestField] = crumb.crumb;\n        }\n\n        const response = await fetch(`${JENKINS_URL}/job/${encodeURIComponent(jobName)}/doDelete`, {\n            method: 'POST',\n            headers,\n        });\n\n        if (response.ok || response.status === 302) {\n            console.log(`[Jenkins] Successfully deleted job '${jobName}'`);\n            return { success: true, message: `Jenkins job '${jobName}' deleted successfully` };\n        } else {\n            const errorText = await response.text();\n            console.error(`[Jenkins] Failed to delete job: ${response.status}`, errorText);\n            return { success: false, message: `Failed to delete Jenkins job: ${response.status}` };\n        }\n    } catch (error) {\n        console.error('[Jenkins] Error deleting job:', error.message);\n        return { success: false, message: `Jenkins error: ${error.message}` };\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 438, "column": 0}, "map": {"version":3,"sources":["file:///home/duwa/Git/fix/Naratel-Devops-Dashboard/src/app/api/manifest/generate/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { execSync } from 'child_process';\nimport fs from 'fs';\nimport path from 'path';\nimport os from 'os';\nimport { gitMutex } from '@/lib/gitMutex';\nimport { createPipelineJob } from '@/lib/jenkins';\n\nexport async function POST(req) {\n    const data = await req.json();\n\n    const repoDirName = 'manifest-repo-workdir';\n    const repoPath = path.join(os.tmpdir(), repoDirName);\n    const registryPath = path.join(repoPath, 'registry.json');\n\n    const token = process.env.GITHUB_TOKEN;\n    const repoUrl = process.env.MANIFEST_REPO_URL;\n    const userName = process.env.GIT_USER_NAME || \"Naratel DevOps Dashboard\";\n    const userEmail = process.env.GIT_USER_EMAIL || \"devops@naratel.com\";\n    const ageKey = \"age1ywhtcmyuhmfa32kfaaxcak4dvq27q9g6m55gqlzu2vlwkgfj24wq3g4ejx\"; // Public Key\n\n    if (!repoUrl || !token) {\n        return NextResponse.json({ error: \"Configuration Error: MANIFEST_REPO_URL or GITHUB_TOKEN is missing.\" }, { status: 500 });\n    }\n\n    return await gitMutex.runExclusive(async () => {\n        try {\n            // --- 0. Git Setup (Clone/Pull) ---\n            const authenticatedUrl = repoUrl.replace(\"https://\", `https://${token}@`);\n\n            if (!fs.existsSync(repoPath)) {\n                console.log(`Cloning repository to ${repoPath}...`);\n                execSync(`git clone ${authenticatedUrl} ${repoPath}`);\n                execSync(`git config user.name \"${userName}\"`, { cwd: repoPath });\n                execSync(`git config user.email \"${userEmail}\"`, { cwd: repoPath });\n            } else {\n                console.log(`Updating repository at ${repoPath}...`);\n                try {\n                    execSync(`git fetch origin`, { cwd: repoPath });\n                    execSync(`git reset --hard origin/main`, { cwd: repoPath });\n                } catch (e) {\n                    console.warn(\"Git pull/reset failed, attempting to re-clone...\", e.message);\n                    fs.rmSync(repoPath, { recursive: true, force: true });\n                    execSync(`git clone ${authenticatedUrl} ${repoPath}`);\n                    execSync(`git config user.name \"${userName}\"`, { cwd: repoPath });\n                    execSync(`git config user.email \"${userEmail}\"`, { cwd: repoPath });\n                }\n            }\n        } catch (error) {\n            console.error(\"Git Setup Failed:\", error.message);\n            return NextResponse.json({ error: \"Failed to initialize git repository: \" + error.message }, { status: 500 });\n        }\n\n        // --- Race Condition Check ---\n        try {\n            if (fs.existsSync(registryPath)) {\n                const content = fs.readFileSync(registryPath, 'utf8');\n                const currentRegistry = JSON.parse(content);\n\n                const isTaken = currentRegistry.some(app => app.id === data.appId);\n\n                if (isTaken) {\n                    let maxId = 0;\n                    currentRegistry.forEach(app => {\n                        const idNum = parseInt(app.id);\n                        if (!isNaN(idNum) && idNum > maxId) maxId = idNum;\n                    });\n                    data.appId = String(maxId + 1).padStart(3, '0');\n                }\n                \n                // Domain Logic (Optional for Prod creation, usually for Test)\n                // We leave domain allocation for deploy-test route mostly.\n            }\n        } catch (e) {\n            console.warn(\"Failed to validate App ID collision:\", e.message);\n        }\n\n        const generatedFolders = [];\n        const errors = [];\n\n        let safeImageRepo = data.imageRepo;\n        if (safeImageRepo && safeImageRepo.startsWith('dockerio/')) {\n            safeImageRepo = safeImageRepo.replace('dockerio/', '');\n        }\n\n        // --- Helper: Parse Secrets ---\n        const parseSecrets = (list) => {\n            const obj = {};\n            if (Array.isArray(list)) {\n                list.forEach(s => {\n                    if (s.key && s.value !== undefined) obj[s.key] = s.value;\n                });\n            }\n            return obj;\n        };\n\n        // Prepare Secret Objects\n        const appSecretsProd = parseSecrets(data.appSecrets);\n        // Note: Frontend should send appSecretsTest if it wants to pre-provision test secrets\n        const appSecretsTest = parseSecrets(data.appSecretsTest || []); \n\n        const dbSecretsProd = parseSecrets(data.dbSecrets);\n        const dbSecretsTest = parseSecrets(data.dbSecretsTest || []);\n\n        // --- DB Key Standardization ---\n        const standardizeDbSecrets = (secretObj, type, appName, env) => {\n            const dbName = appName.replace(/-/g, '_') + (env === 'testing' ? '_testing' : '');\n            \n            if (type === 'postgres') {\n                Object.keys(secretObj).forEach(k => {\n                    if (k.startsWith('MYSQL_') || k.startsWith('MARIADB_')) delete secretObj[k];\n                });\n                \n                secretObj[\"POSTGRESQL_DATABASE\"] = secretObj[\"POSTGRESQL_DATABASE\"] || secretObj[\"POSTGRES_DB\"] || secretObj[\"DB_NAME\"] || dbName;\n                secretObj[\"POSTGRESQL_USERNAME\"] = secretObj[\"POSTGRESQL_USERNAME\"] || secretObj[\"POSTGRES_USER\"] || secretObj[\"DB_USER\"] || \"postgres\";\n                secretObj[\"POSTGRESQL_PASSWORD\"] = secretObj[\"POSTGRESQL_PASSWORD\"] || secretObj[\"POSTGRES_PASSWORD\"] || secretObj[\"DB_PASS\"] || \"changeme_securely\";\n                secretObj[\"POSTGRESQL_POSTGRES_PASSWORD\"] = secretObj[\"POSTGRESQL_PASSWORD\"];\n\n                delete secretObj[\"POSTGRES_DB\"]; delete secretObj[\"POSTGRES_USER\"]; delete secretObj[\"POSTGRES_PASSWORD\"];\n                delete secretObj[\"DB_NAME\"]; delete secretObj[\"DB_USER\"]; delete secretObj[\"DB_PASS\"];\n            } else {\n                Object.keys(secretObj).forEach(k => {\n                    if (k.startsWith('POSTGRES_') || k.startsWith('POSTGRESQL_')) delete secretObj[k];\n                });\n\n                secretObj[\"MARIADB_DATABASE\"] = secretObj[\"MARIADB_DATABASE\"] || secretObj[\"MYSQL_DATABASE\"] || secretObj[\"DB_NAME\"] || dbName;\n                secretObj[\"MARIADB_USER\"] = secretObj[\"MARIADB_USER\"] || secretObj[\"MYSQL_USER\"] || secretObj[\"DB_USER\"] || \"app_user\";\n                secretObj[\"MARIADB_PASSWORD\"] = secretObj[\"MARIADB_PASSWORD\"] || secretObj[\"MYSQL_PASSWORD\"] || secretObj[\"DB_PASS\"] || \"changeme_securely\";\n                secretObj[\"MARIADB_ROOT_PASSWORD\"] = secretObj[\"MARIADB_ROOT_PASSWORD\"] || secretObj[\"MYSQL_ROOT_PASSWORD\"] || \"changeme_root\";\n\n                delete secretObj[\"MYSQL_DATABASE\"]; delete secretObj[\"MYSQL_USER\"]; delete secretObj[\"MYSQL_PASSWORD\"];\n                delete secretObj[\"MYSQL_ROOT_PASSWORD\"]; delete secretObj[\"DB_NAME\"]; delete secretObj[\"DB_USER\"]; delete secretObj[\"DB_PASS\"];\n            }\n            return secretObj;\n        };\n\n        if (data.dbType !== 'none') {\n            standardizeDbSecrets(dbSecretsProd, data.dbType, data.appName, 'prod');\n            if (Object.keys(dbSecretsTest).length > 0) {\n                standardizeDbSecrets(dbSecretsTest, data.dbType, data.appName, 'testing');\n            }\n        }\n\n        // --- Helper: Format Secrets to YAML ---\n        const formatSecrets = (obj) => {\n            if (Object.keys(obj).length === 0) return '{}';\n            return Object.entries(obj)\n                .map(([k, v]) => {\n                    const safeVal = String(v).replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n                    return `  ${k}: \"${safeVal}\"`;\n                })\n                .join('\\n');\n        };\n\n        // --- Generator Logic ---\n        const generateYaml = (templateType, env, secretsObj) => {\n            const appName = data.appName;\n            const appId = data.appId;\n            let values = \"\";\n            let secrets = `secretData:\\n${formatSecrets(secretsObj)}`;\n\n            // Inject DB Connection for App\n            if (templateType.startsWith('app') && data.dbType !== 'none') {\n                const dbPort = data.dbType === 'postgres' ? \"5432\" : \"3306\";\n                // Prod: svc-db-APP-ID.ID-db-APP-prod...\n                // Test: svc-db-APP-ID.ID-db-APP-testing...\n                const nsSuffix = env === 'prod' ? 'prod' : 'testing';\n                \n                // Note: We don't inject into secretsObj here because secretsObj is passed in.\n                // But we should ensure the app knows where to connect.\n                // Usually this is done via secrets or env vars. \n                // Since this is initial generation, users usually put connection details in the secrets form.\n                // We can Auto-Inject them into the secretsObj if they are missing?\n                // For simplicity, we assume user/frontend populated the secrets OR we rely on standard vars.\n                \n                // Actually, let's inject DB_HOST into values.extraEnv if not present, to be safe.\n                // But wait, secrets are preferred.\n            }\n\n            if (templateType === 'app-prod') {\n                values = `\nnamespace: \"${appId}-${appName}-prod\"\ncontrollerType: Deployment\napp:\n  id: \"${appId}\"\n  name: \"${appName}\"\n  env: \"prod\"\nimage:\n  repository: \"${safeImageRepo}\"\n  tag: \"${data.imageTag}\"\nimagePullSecrets:\n  - name: \"dockerhub-auth\"\nservice:\n  port: ${data.servicePort}\n  targetPort: ${data.targetPort}\n`.trim();\n                if (data.migrationEnabled) {\n                    const checkImage = data.dbType === 'postgres' ? 'devopsnaratel/postgresql:18.1' : 'devopsnaratel/mariadb:12.1.2';\n                    values += `\nmigration:\n  enabled: true\n  command: \"${data.migrationCommand}\"\n  checkImage: \"${checkImage}\"`;\n                }\n                if (data.dbType !== 'none') {\n                    values += `\nbackup:\n  enabled: true\n  type: \"${data.dbType}\"`;\n                }\n                if (data.ingressEnabled) {\n                    values += `\ningress:\n  enabled: true\n  className: \"nginx\"\n  hosts:\n    - host: \"${data.ingressHost}\"\n      path: /\n`;\n                    if (data.tlsEnabled) {\n                        values += `  tls:\n    - secretName: \"${appName}-tls\"\n      hosts:\n        - \"${data.ingressHost}\"`;\n                    }\n                }\n            }\n\n            if (templateType === 'db-prod') {\n                const dbType = data.dbType;\n                const dbImage = dbType === 'postgres' ? 'devopsnaratel/postgresql' : 'devopsnaratel/mariadb';\n                const dbTag = dbType === 'postgres' ? '18.1' : '12.1.2';\n                \n                let dbSpecificConfig = '';\n                if (dbType === 'mariadb') {\n                    dbSpecificConfig = `\nmariadb:\n  image:\n    repository: \"${dbImage}\"\n    tag: \"${dbTag}\"\n  backup:\n    schedule: \"0 1 * * *\"\n  restore:\n    enabled: \"false\"\n    s3Path: \"\"\n    sourceNamespace: \"\"`;\n                } else {\n                    dbSpecificConfig = `\npostgres:\n  image:\n    repository: \"${dbImage}\"\n    tag: \"${dbTag}\"\n  backup:\n    schedule: \"0 1 * * *\"\n  restore:\n    enabled: \"false\"\n    s3Path: \"\"\n    sourceNamespace: \"\"`;\n                }\n                \n                values = `\n# Generated by Naratel Dashboard - Enterprise Database Manifest\nnamespace: \"${appId}-db-${appName}-prod\"\nfullnameOverride: \"sts-db-${appName}-${appId}\"\ndatabaseType: \"${dbType}\"\n\ns3:\n  endpoint: \"http://10.246.2.154:8010\"\n  bucket: \"${dbType === 'postgres' ? 'postgres-wal-archive' : 'mariadb-wal-archive'}\"\n  region: \"us-east-1\"\n\nstorage:\n  className: \"${data.storageClass || 'longhorn'}\"\n  size: \"10Gi\"\n\nimagePullSecrets:\n  - name: \"dockerhub-auth\"\n\nserviceAccount:\n  create: true\n  name: \"sa-db-${appName}\"\n\n${dbSpecificConfig.trim()}\n\npodAnnotations:\n  app.kubernetes.io/id: \"${appId}\"\n  app.kubernetes.io/env: \"prod\"\n  backup.naratel.com/enabled: \"true\"\n`.trim();\n            }\n\n            return { values, secrets };\n        };\n\n        // --- Helper: Write & Encrypt ---\n        const processManifest = (folderName, type, env, secretObj) => {\n            const targetFolder = path.join(repoPath, 'apps', folderName);\n            const valuesPath = path.join(targetFolder, 'values.yaml');\n            const secretsPath = path.join(targetFolder, 'secrets.yaml');\n\n            if (!fs.existsSync(targetFolder)) fs.mkdirSync(targetFolder, { recursive: true });\n\n            const { values, secrets } = generateYaml(type, env, secretObj);\n\n            // Write Values\n            fs.writeFileSync(valuesPath, values);\n\n            // Write Secrets\n            fs.writeFileSync(secretsPath, secrets);\n\n            // Encrypt Secrets\n            try {\n                execSync(`sops --encrypt --age ${ageKey} --encrypted-regex '^(secretData)$' --in-place ${secretsPath}`, { cwd: repoPath });\n                generatedFolders.push(folderName);\n            } catch (e) {\n                console.error(`Encryption failed for ${folderName}`, e);\n                errors.push(`Encryption failed for ${folderName}: ${e.message}`);\n            }\n        };\n\n        // --- Helper: Generate Secret File ONLY (For Testing Standby) ---\n        const generateSecretFile = (folderName, secretObj) => {\n            const targetFolder = path.join(repoPath, 'apps', folderName);\n            const secretsPath = path.join(targetFolder, 'secrets.yaml');\n\n            if (!fs.existsSync(targetFolder)) fs.mkdirSync(targetFolder, { recursive: true });\n\n            const secrets = `secretData:\\n${formatSecrets(secretObj)}`;\n            fs.writeFileSync(secretsPath, secrets);\n\n            try {\n                execSync(`sops --encrypt --age ${ageKey} --encrypted-regex '^(secretData)$' --in-place ${secretsPath}`, { cwd: repoPath });\n                console.log(`[Secrets] Generated standby secrets for ${folderName}`);\n            } catch (e) {\n                console.error(`Encryption failed for ${folderName}`, e);\n            }\n        };\n\n        try {\n            // 1. Generate PROD Manifests (Values + Secrets)\n            processManifest(`${data.appId}-${data.appName}-prod`, 'app-prod', 'prod', appSecretsProd);\n\n            if (data.dbType !== 'none') {\n                processManifest(`${data.appId}-db-${data.appName}-prod`, 'db-prod', 'prod', dbSecretsProd);\n            }\n\n            // 2. Generate TESTING Secrets (Standby) - Only if provided\n            if (Object.keys(appSecretsTest).length > 0) {\n                generateSecretFile(`${data.appId}-${data.appName}-testing`, appSecretsTest);\n            }\n            \n            if (data.dbType !== 'none' && Object.keys(dbSecretsTest).length > 0) {\n                generateSecretFile(`${data.appId}-db-${data.appName}-testing`, dbSecretsTest);\n            }\n\n            // Update Registry\n            try {\n                let registry = [];\n                if (fs.existsSync(registryPath)) {\n                    const content = fs.readFileSync(registryPath, 'utf8');\n                    try { registry = JSON.parse(content); } catch (e) { registry = []; }\n                }\n                const existingIdx = registry.findIndex(r => r.id === data.appId);\n                const newEntry = {\n                    id: data.appId,\n                    name: data.appName,\n                    image: `${safeImageRepo}:${data.imageTag}`,\n                    db: data.dbType,\n                    ingressHost: data.ingressEnabled ? data.ingressHost : null,\n                    gitRepoUrl: data.gitRepoUrl || null,\n                    createdAt: new Date().toISOString()\n                };\n                if (existingIdx >= 0) {\n                    // Preserve testDomain if exists\n                    if (registry[existingIdx].testDomain) newEntry.testDomain = registry[existingIdx].testDomain;\n                    registry[existingIdx] = newEntry;\n                } else {\n                    registry.push(newEntry);\n                }\n                fs.writeFileSync(registryPath, JSON.stringify(registry, null, 2));\n            } catch (regError) {\n                errors.push(\"Failed to update registry.json: \" + regError.message);\n            }\n\n            if (errors.length > 0) {\n                return NextResponse.json({ error: errors.join(', '), generated: generatedFolders }, { status: 400 });\n            }\n\n            // Commit & Push\n            const commitMsg = `feat: add/update manifests for ${data.appName} (split structure + testing secrets)`;\n            execSync(`git add .`, { cwd: repoPath });\n            try {\n                execSync(`git commit -m \"${commitMsg}\"`, { cwd: repoPath });\n                execSync(`git push origin main`, { cwd: repoPath });\n            } catch (e) {\n                if (e.message.includes('nothing to commit')) {\n                    return NextResponse.json({ message: \"No changes detected.\" });\n                }\n                throw e;\n            }\n\n            // Jenkins... (Keep existing)\n            let jenkinsMessage = '';\n            if (data.gitRepoUrl) {\n                try {\n                    const jenkinsResult = await createPipelineJob({\n                        appName: data.appName,\n                        imageRepo: safeImageRepo,\n                        gitRepoUrl: data.gitRepoUrl\n                    });\n                    if (jenkinsResult.success) {\n                        jenkinsMessage = ` | ${jenkinsResult.message}`;\n                    }\n                } catch (jenkinsErr) {\n                    console.error('[Jenkins] Failed to create pipeline:', jenkinsErr.message);\n                }\n            }\n\n            return NextResponse.json({\n                message: `Success! Generated ${generatedFolders.join(', ')}${jenkinsMessage}`,\n                folders: generatedFolders\n            });\n\n        } catch (err) {\n            console.error(err);\n            return NextResponse.json({ error: err.message }, { status: 500 });\n        }\n    });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,GAAG;IAC1B,MAAM,OAAO,MAAM,IAAI,IAAI;IAE3B,MAAM,cAAc;IACpB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,wGAAE,CAAC,MAAM,IAAI;IACxC,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,UAAU;IAEzC,MAAM,QAAQ,QAAQ,GAAG,CAAC,YAAY;IACtC,MAAM,UAAU,QAAQ,GAAG,CAAC,iBAAiB;IAC7C,MAAM,WAAW,QAAQ,GAAG,CAAC,aAAa,IAAI;IAC9C,MAAM,YAAY,QAAQ,GAAG,CAAC,cAAc,IAAI;IAChD,MAAM,SAAS,kEAAkE,aAAa;IAE9F,IAAI,CAAC,WAAW,CAAC,OAAO;QACpB,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqE,GAAG;YAAE,QAAQ;QAAI;IAC5H;IAEA,OAAO,MAAM,6KAAQ,CAAC,YAAY,CAAC;QAC/B,IAAI;YACA,oCAAoC;YACpC,MAAM,mBAAmB,QAAQ,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;YAExE,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,WAAW;gBAC1B,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,SAAS,GAAG,CAAC;gBAClD,IAAA,+HAAQ,EAAC,CAAC,UAAU,EAAE,iBAAiB,CAAC,EAAE,UAAU;gBACpD,IAAA,+HAAQ,EAAC,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC,EAAE;oBAAE,KAAK;gBAAS;gBAC/D,IAAA,+HAAQ,EAAC,CAAC,uBAAuB,EAAE,UAAU,CAAC,CAAC,EAAE;oBAAE,KAAK;gBAAS;YACrE,OAAO;gBACH,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,SAAS,GAAG,CAAC;gBACnD,IAAI;oBACA,IAAA,+HAAQ,EAAC,CAAC,gBAAgB,CAAC,EAAE;wBAAE,KAAK;oBAAS;oBAC7C,IAAA,+HAAQ,EAAC,CAAC,4BAA4B,CAAC,EAAE;wBAAE,KAAK;oBAAS;gBAC7D,EAAE,OAAO,GAAG;oBACR,QAAQ,IAAI,CAAC,oDAAoD,EAAE,OAAO;oBAC1E,wGAAE,CAAC,MAAM,CAAC,UAAU;wBAAE,WAAW;wBAAM,OAAO;oBAAK;oBACnD,IAAA,+HAAQ,EAAC,CAAC,UAAU,EAAE,iBAAiB,CAAC,EAAE,UAAU;oBACpD,IAAA,+HAAQ,EAAC,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC,EAAE;wBAAE,KAAK;oBAAS;oBAC/D,IAAA,+HAAQ,EAAC,CAAC,uBAAuB,EAAE,UAAU,CAAC,CAAC,EAAE;wBAAE,KAAK;oBAAS;gBACrE;YACJ;QACJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,qBAAqB,MAAM,OAAO;YAChD,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,0CAA0C,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC/G;QAEA,+BAA+B;QAC/B,IAAI;YACA,IAAI,wGAAE,CAAC,UAAU,CAAC,eAAe;gBAC7B,MAAM,UAAU,wGAAE,CAAC,YAAY,CAAC,cAAc;gBAC9C,MAAM,kBAAkB,KAAK,KAAK,CAAC;gBAEnC,MAAM,UAAU,gBAAgB,IAAI,CAAC,CAAA,MAAO,IAAI,EAAE,KAAK,KAAK,KAAK;gBAEjE,IAAI,SAAS;oBACT,IAAI,QAAQ;oBACZ,gBAAgB,OAAO,CAAC,CAAA;wBACpB,MAAM,QAAQ,SAAS,IAAI,EAAE;wBAC7B,IAAI,CAAC,MAAM,UAAU,QAAQ,OAAO,QAAQ;oBAChD;oBACA,KAAK,KAAK,GAAG,OAAO,QAAQ,GAAG,QAAQ,CAAC,GAAG;gBAC/C;YAEA,8DAA8D;YAC9D,2DAA2D;YAC/D;QACJ,EAAE,OAAO,GAAG;YACR,QAAQ,IAAI,CAAC,wCAAwC,EAAE,OAAO;QAClE;QAEA,MAAM,mBAAmB,EAAE;QAC3B,MAAM,SAAS,EAAE;QAEjB,IAAI,gBAAgB,KAAK,SAAS;QAClC,IAAI,iBAAiB,cAAc,UAAU,CAAC,cAAc;YACxD,gBAAgB,cAAc,OAAO,CAAC,aAAa;QACvD;QAEA,gCAAgC;QAChC,MAAM,eAAe,CAAC;YAClB,MAAM,MAAM,CAAC;YACb,IAAI,MAAM,OAAO,CAAC,OAAO;gBACrB,KAAK,OAAO,CAAC,CAAA;oBACT,IAAI,EAAE,GAAG,IAAI,EAAE,KAAK,KAAK,WAAW,GAAG,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,KAAK;gBAC5D;YACJ;YACA,OAAO;QACX;QAEA,yBAAyB;QACzB,MAAM,iBAAiB,aAAa,KAAK,UAAU;QACnD,sFAAsF;QACtF,MAAM,iBAAiB,aAAa,KAAK,cAAc,IAAI,EAAE;QAE7D,MAAM,gBAAgB,aAAa,KAAK,SAAS;QACjD,MAAM,gBAAgB,aAAa,KAAK,aAAa,IAAI,EAAE;QAE3D,iCAAiC;QACjC,MAAM,uBAAuB,CAAC,WAAW,MAAM,SAAS;YACpD,MAAM,SAAS,QAAQ,OAAO,CAAC,MAAM,OAAO,CAAC,QAAQ,YAAY,aAAa,EAAE;YAEhF,IAAI,SAAS,YAAY;gBACrB,OAAO,IAAI,CAAC,WAAW,OAAO,CAAC,CAAA;oBAC3B,IAAI,EAAE,UAAU,CAAC,aAAa,EAAE,UAAU,CAAC,aAAa,OAAO,SAAS,CAAC,EAAE;gBAC/E;gBAEA,SAAS,CAAC,sBAAsB,GAAG,SAAS,CAAC,sBAAsB,IAAI,SAAS,CAAC,cAAc,IAAI,SAAS,CAAC,UAAU,IAAI;gBAC3H,SAAS,CAAC,sBAAsB,GAAG,SAAS,CAAC,sBAAsB,IAAI,SAAS,CAAC,gBAAgB,IAAI,SAAS,CAAC,UAAU,IAAI;gBAC7H,SAAS,CAAC,sBAAsB,GAAG,SAAS,CAAC,sBAAsB,IAAI,SAAS,CAAC,oBAAoB,IAAI,SAAS,CAAC,UAAU,IAAI;gBACjI,SAAS,CAAC,+BAA+B,GAAG,SAAS,CAAC,sBAAsB;gBAE5E,OAAO,SAAS,CAAC,cAAc;gBAAE,OAAO,SAAS,CAAC,gBAAgB;gBAAE,OAAO,SAAS,CAAC,oBAAoB;gBACzG,OAAO,SAAS,CAAC,UAAU;gBAAE,OAAO,SAAS,CAAC,UAAU;gBAAE,OAAO,SAAS,CAAC,UAAU;YACzF,OAAO;gBACH,OAAO,IAAI,CAAC,WAAW,OAAO,CAAC,CAAA;oBAC3B,IAAI,EAAE,UAAU,CAAC,gBAAgB,EAAE,UAAU,CAAC,gBAAgB,OAAO,SAAS,CAAC,EAAE;gBACrF;gBAEA,SAAS,CAAC,mBAAmB,GAAG,SAAS,CAAC,mBAAmB,IAAI,SAAS,CAAC,iBAAiB,IAAI,SAAS,CAAC,UAAU,IAAI;gBACxH,SAAS,CAAC,eAAe,GAAG,SAAS,CAAC,eAAe,IAAI,SAAS,CAAC,aAAa,IAAI,SAAS,CAAC,UAAU,IAAI;gBAC5G,SAAS,CAAC,mBAAmB,GAAG,SAAS,CAAC,mBAAmB,IAAI,SAAS,CAAC,iBAAiB,IAAI,SAAS,CAAC,UAAU,IAAI;gBACxH,SAAS,CAAC,wBAAwB,GAAG,SAAS,CAAC,wBAAwB,IAAI,SAAS,CAAC,sBAAsB,IAAI;gBAE/G,OAAO,SAAS,CAAC,iBAAiB;gBAAE,OAAO,SAAS,CAAC,aAAa;gBAAE,OAAO,SAAS,CAAC,iBAAiB;gBACtG,OAAO,SAAS,CAAC,sBAAsB;gBAAE,OAAO,SAAS,CAAC,UAAU;gBAAE,OAAO,SAAS,CAAC,UAAU;gBAAE,OAAO,SAAS,CAAC,UAAU;YAClI;YACA,OAAO;QACX;QAEA,IAAI,KAAK,MAAM,KAAK,QAAQ;YACxB,qBAAqB,eAAe,KAAK,MAAM,EAAE,KAAK,OAAO,EAAE;YAC/D,IAAI,OAAO,IAAI,CAAC,eAAe,MAAM,GAAG,GAAG;gBACvC,qBAAqB,eAAe,KAAK,MAAM,EAAE,KAAK,OAAO,EAAE;YACnE;QACJ;QAEA,yCAAyC;QACzC,MAAM,gBAAgB,CAAC;YACnB,IAAI,OAAO,IAAI,CAAC,KAAK,MAAM,KAAK,GAAG,OAAO;YAC1C,OAAO,OAAO,OAAO,CAAC,KACjB,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE;gBACR,MAAM,UAAU,OAAO,GAAG,OAAO,CAAC,OAAO,QAAQ,OAAO,CAAC,MAAM;gBAC/D,OAAO,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;YACjC,GACC,IAAI,CAAC;QACd;QAEA,0BAA0B;QAC1B,MAAM,eAAe,CAAC,cAAc,KAAK;YACrC,MAAM,UAAU,KAAK,OAAO;YAC5B,MAAM,QAAQ,KAAK,KAAK;YACxB,IAAI,SAAS;YACb,IAAI,UAAU,CAAC,aAAa,EAAE,cAAc,aAAa;YAEzD,+BAA+B;YAC/B,IAAI,aAAa,UAAU,CAAC,UAAU,KAAK,MAAM,KAAK,QAAQ;gBAC1D,MAAM,SAAS,KAAK,MAAM,KAAK,aAAa,SAAS;gBACrD,wCAAwC;gBACxC,2CAA2C;gBAC3C,MAAM,WAAW,QAAQ,SAAS,SAAS;YAE3C,8EAA8E;YAC9E,uDAAuD;YACvD,iDAAiD;YACjD,8FAA8F;YAC9F,mEAAmE;YACnE,6FAA6F;YAE7F,kFAAkF;YAClF,mCAAmC;YACvC;YAEA,IAAI,iBAAiB,YAAY;gBAC7B,SAAS,CAAC;YACd,EAAE,MAAM,CAAC,EAAE,QAAQ;;;OAGxB,EAAE,MAAM;SACN,EAAE,QAAQ;;;eAGJ,EAAE,cAAc;QACvB,EAAE,KAAK,QAAQ,CAAC;;;;QAIhB,EAAE,KAAK,WAAW,CAAC;cACb,EAAE,KAAK,UAAU,CAAC;AAChC,CAAC,CAAC,IAAI;gBACU,IAAI,KAAK,gBAAgB,EAAE;oBACvB,MAAM,aAAa,KAAK,MAAM,KAAK,aAAa,kCAAkC;oBAClF,UAAU,CAAC;;;YAGnB,EAAE,KAAK,gBAAgB,CAAC;eACrB,EAAE,WAAW,CAAC,CAAC;gBACd;gBACA,IAAI,KAAK,MAAM,KAAK,QAAQ;oBACxB,UAAU,CAAC;;;SAGtB,EAAE,KAAK,MAAM,CAAC,CAAC,CAAC;gBACT;gBACA,IAAI,KAAK,cAAc,EAAE;oBACrB,UAAU,CAAC;;;;;aAKlB,EAAE,KAAK,WAAW,CAAC;;AAEhC,CAAC;oBACmB,IAAI,KAAK,UAAU,EAAE;wBACjB,UAAU,CAAC;mBAChB,EAAE,QAAQ;;WAElB,EAAE,KAAK,WAAW,CAAC,CAAC,CAAC;oBACZ;gBACJ;YACJ;YAEA,IAAI,iBAAiB,WAAW;gBAC5B,MAAM,SAAS,KAAK,MAAM;gBAC1B,MAAM,UAAU,WAAW,aAAa,6BAA6B;gBACrE,MAAM,QAAQ,WAAW,aAAa,SAAS;gBAE/C,IAAI,mBAAmB;gBACvB,IAAI,WAAW,WAAW;oBACtB,mBAAmB,CAAC;;;iBAGvB,EAAE,QAAQ;UACjB,EAAE,MAAM;;;;;;uBAMK,CAAC;gBACR,OAAO;oBACH,mBAAmB,CAAC;;;iBAGvB,EAAE,QAAQ;UACjB,EAAE,MAAM;;;;;;uBAMK,CAAC;gBACR;gBAEA,SAAS,CAAC;;YAEd,EAAE,MAAM,IAAI,EAAE,QAAQ;0BACR,EAAE,QAAQ,CAAC,EAAE,MAAM;eAC9B,EAAE,OAAO;;;;WAIb,EAAE,WAAW,aAAa,yBAAyB,sBAAsB;;;;cAItE,EAAE,KAAK,YAAY,IAAI,WAAW;;;;;;;;eAQjC,EAAE,QAAQ;;AAEzB,EAAE,iBAAiB,IAAI,GAAG;;;yBAGD,EAAE,MAAM;;;AAGjC,CAAC,CAAC,IAAI;YACM;YAEA,OAAO;gBAAE;gBAAQ;YAAQ;QAC7B;QAEA,kCAAkC;QAClC,MAAM,kBAAkB,CAAC,YAAY,MAAM,KAAK;YAC5C,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,UAAU,QAAQ;YACjD,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,cAAc;YAC3C,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,cAAc;YAE5C,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,eAAe,wGAAE,CAAC,SAAS,CAAC,cAAc;gBAAE,WAAW;YAAK;YAE/E,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,aAAa,MAAM,KAAK;YAEpD,eAAe;YACf,wGAAE,CAAC,aAAa,CAAC,YAAY;YAE7B,gBAAgB;YAChB,wGAAE,CAAC,aAAa,CAAC,aAAa;YAE9B,kBAAkB;YAClB,IAAI;gBACA,IAAA,+HAAQ,EAAC,CAAC,qBAAqB,EAAE,OAAO,+CAA+C,EAAE,aAAa,EAAE;oBAAE,KAAK;gBAAS;gBACxH,iBAAiB,IAAI,CAAC;YAC1B,EAAE,OAAO,GAAG;gBACR,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,YAAY,EAAE;gBACrD,OAAO,IAAI,CAAC,CAAC,sBAAsB,EAAE,WAAW,EAAE,EAAE,EAAE,OAAO,EAAE;YACnE;QACJ;QAEA,kEAAkE;QAClE,MAAM,qBAAqB,CAAC,YAAY;YACpC,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,UAAU,QAAQ;YACjD,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,cAAc;YAE5C,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,eAAe,wGAAE,CAAC,SAAS,CAAC,cAAc;gBAAE,WAAW;YAAK;YAE/E,MAAM,UAAU,CAAC,aAAa,EAAE,cAAc,YAAY;YAC1D,wGAAE,CAAC,aAAa,CAAC,aAAa;YAE9B,IAAI;gBACA,IAAA,+HAAQ,EAAC,CAAC,qBAAqB,EAAE,OAAO,+CAA+C,EAAE,aAAa,EAAE;oBAAE,KAAK;gBAAS;gBACxH,QAAQ,GAAG,CAAC,CAAC,wCAAwC,EAAE,YAAY;YACvE,EAAE,OAAO,GAAG;gBACR,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,YAAY,EAAE;YACzD;QACJ;QAEA,IAAI;YACA,gDAAgD;YAChD,gBAAgB,GAAG,KAAK,KAAK,CAAC,CAAC,EAAE,KAAK,OAAO,CAAC,KAAK,CAAC,EAAE,YAAY,QAAQ;YAE1E,IAAI,KAAK,MAAM,KAAK,QAAQ;gBACxB,gBAAgB,GAAG,KAAK,KAAK,CAAC,IAAI,EAAE,KAAK,OAAO,CAAC,KAAK,CAAC,EAAE,WAAW,QAAQ;YAChF;YAEA,2DAA2D;YAC3D,IAAI,OAAO,IAAI,CAAC,gBAAgB,MAAM,GAAG,GAAG;gBACxC,mBAAmB,GAAG,KAAK,KAAK,CAAC,CAAC,EAAE,KAAK,OAAO,CAAC,QAAQ,CAAC,EAAE;YAChE;YAEA,IAAI,KAAK,MAAM,KAAK,UAAU,OAAO,IAAI,CAAC,eAAe,MAAM,GAAG,GAAG;gBACjE,mBAAmB,GAAG,KAAK,KAAK,CAAC,IAAI,EAAE,KAAK,OAAO,CAAC,QAAQ,CAAC,EAAE;YACnE;YAEA,kBAAkB;YAClB,IAAI;gBACA,IAAI,WAAW,EAAE;gBACjB,IAAI,wGAAE,CAAC,UAAU,CAAC,eAAe;oBAC7B,MAAM,UAAU,wGAAE,CAAC,YAAY,CAAC,cAAc;oBAC9C,IAAI;wBAAE,WAAW,KAAK,KAAK,CAAC;oBAAU,EAAE,OAAO,GAAG;wBAAE,WAAW,EAAE;oBAAE;gBACvE;gBACA,MAAM,cAAc,SAAS,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,KAAK;gBAC/D,MAAM,WAAW;oBACb,IAAI,KAAK,KAAK;oBACd,MAAM,KAAK,OAAO;oBAClB,OAAO,GAAG,cAAc,CAAC,EAAE,KAAK,QAAQ,EAAE;oBAC1C,IAAI,KAAK,MAAM;oBACf,aAAa,KAAK,cAAc,GAAG,KAAK,WAAW,GAAG;oBACtD,YAAY,KAAK,UAAU,IAAI;oBAC/B,WAAW,IAAI,OAAO,WAAW;gBACrC;gBACA,IAAI,eAAe,GAAG;oBAClB,gCAAgC;oBAChC,IAAI,QAAQ,CAAC,YAAY,CAAC,UAAU,EAAE,SAAS,UAAU,GAAG,QAAQ,CAAC,YAAY,CAAC,UAAU;oBAC5F,QAAQ,CAAC,YAAY,GAAG;gBAC5B,OAAO;oBACH,SAAS,IAAI,CAAC;gBAClB;gBACA,wGAAE,CAAC,aAAa,CAAC,cAAc,KAAK,SAAS,CAAC,UAAU,MAAM;YAClE,EAAE,OAAO,UAAU;gBACf,OAAO,IAAI,CAAC,qCAAqC,SAAS,OAAO;YACrE;YAEA,IAAI,OAAO,MAAM,GAAG,GAAG;gBACnB,OAAO,yLAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,OAAO,IAAI,CAAC;oBAAO,WAAW;gBAAiB,GAAG;oBAAE,QAAQ;gBAAI;YACtG;YAEA,gBAAgB;YAChB,MAAM,YAAY,CAAC,+BAA+B,EAAE,KAAK,OAAO,CAAC,oCAAoC,CAAC;YACtG,IAAA,+HAAQ,EAAC,CAAC,SAAS,CAAC,EAAE;gBAAE,KAAK;YAAS;YACtC,IAAI;gBACA,IAAA,+HAAQ,EAAC,CAAC,eAAe,EAAE,UAAU,CAAC,CAAC,EAAE;oBAAE,KAAK;gBAAS;gBACzD,IAAA,+HAAQ,EAAC,CAAC,oBAAoB,CAAC,EAAE;oBAAE,KAAK;gBAAS;YACrD,EAAE,OAAO,GAAG;gBACR,IAAI,EAAE,OAAO,CAAC,QAAQ,CAAC,sBAAsB;oBACzC,OAAO,yLAAY,CAAC,IAAI,CAAC;wBAAE,SAAS;oBAAuB;gBAC/D;gBACA,MAAM;YACV;YAEA,6BAA6B;YAC7B,IAAI,iBAAiB;YACrB,IAAI,KAAK,UAAU,EAAE;gBACjB,IAAI;oBACA,MAAM,gBAAgB,MAAM,IAAA,qLAAiB,EAAC;wBAC1C,SAAS,KAAK,OAAO;wBACrB,WAAW;wBACX,YAAY,KAAK,UAAU;oBAC/B;oBACA,IAAI,cAAc,OAAO,EAAE;wBACvB,iBAAiB,CAAC,GAAG,EAAE,cAAc,OAAO,EAAE;oBAClD;gBACJ,EAAE,OAAO,YAAY;oBACjB,QAAQ,KAAK,CAAC,wCAAwC,WAAW,OAAO;gBAC5E;YACJ;YAEA,OAAO,yLAAY,CAAC,IAAI,CAAC;gBACrB,SAAS,CAAC,mBAAmB,EAAE,iBAAiB,IAAI,CAAC,QAAQ,gBAAgB;gBAC7E,SAAS;YACb;QAEJ,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC;YACd,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,IAAI,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;IACJ;AACJ"}}]
}