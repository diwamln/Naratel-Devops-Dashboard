{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///home/duwa/Git/Naratel-Devops-Dashboard/src/app/api/manifest/generate/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { execSync } from 'child_process';\nimport fs from 'fs';\nimport path from 'path';\nimport os from 'os';\n\nexport async function POST(req) {\n  const data = await req.json();\n  \n  const repoDirName = 'manifest-repo-workdir';\n  const repoPath = path.join(os.tmpdir(), repoDirName);\n  const registryPath = path.join(repoPath, 'registry.json');\n  \n  const token = process.env.GITHUB_TOKEN;\n  const repoUrl = process.env.MANIFEST_REPO_URL;\n  const userName = process.env.GIT_USER_NAME || \"Naratel DevOps Dashboard\";\n  const userEmail = process.env.GIT_USER_EMAIL || \"devops@naratel.com\";\n  const ageKey = \"age1ywhtcmyuhmfa32kfaaxcak4dvq27q9g6m55gqlzu2vlwkgfj24wq3g4ejx\";\n\n  if (!repoUrl || !token) {\n      return NextResponse.json({ error: \"Configuration Error: MANIFEST_REPO_URL or GITHUB_TOKEN is missing.\" }, { status: 500 });\n  }\n\n  try {\n      // --- 0. Git Setup (Clone/Pull) ---\n      const authenticatedUrl = repoUrl.replace(\"https://\", `https://${token}@`);\n\n      if (!fs.existsSync(repoPath)) {\n          console.log(`Cloning repository to ${repoPath}...`);\n          execSync(`git clone ${authenticatedUrl} ${repoPath}`);\n          execSync(`git config user.name \"${userName}\"`, { cwd: repoPath });\n          execSync(`git config user.email \"${userEmail}\"`, { cwd: repoPath });\n      } else {\n          console.log(`Updating repository at ${repoPath}...`);\n          try {\n             execSync(`git fetch origin`, { cwd: repoPath });\n             execSync(`git reset --hard origin/main`, { cwd: repoPath });\n          } catch (e) {\n             console.warn(\"Git pull/reset failed, attempting to re-clone...\", e.message);\n             fs.rmSync(repoPath, { recursive: true, force: true });\n             execSync(`git clone ${authenticatedUrl} ${repoPath}`);\n             execSync(`git config user.name \"${userName}\"`, { cwd: repoPath });\n             execSync(`git config user.email \"${userEmail}\"`, { cwd: repoPath });\n          }\n      }\n  } catch (error) {\n      console.error(\"Git Setup Failed:\", error.message);\n      return NextResponse.json({ error: \"Failed to initialize git repository: \" + error.message }, { status: 500 });\n  }\n\n  const generatedFolders = [];\n  const errors = [];\n\n  // Sanitize Image Repo (Remove accidental 'dockerio/' prefix)\n  let safeImageRepo = data.imageRepo;\n  if (safeImageRepo && safeImageRepo.startsWith('dockerio/')) {\n      safeImageRepo = safeImageRepo.replace('dockerio/', '');\n  }\n\n  // --- Helper: Generate YAML Content ---\n  const generateYaml = (templateType, env) => {\n    // Common Variables\n    const appName = data.appName;\n    const appId = data.appId;\n    \n    // --- APP SECRETS Construction ---\n    const appSecretObj = {};\n    if (data.appSecrets && Array.isArray(data.appSecrets)) {\n        data.appSecrets.forEach(s => {\n            let val = s.value;\n            if (env === 'prod' && s.valueProd) val = s.valueProd;\n            if (env === 'testing' && s.valueTest) val = s.valueTest;\n            \n            if (s.key && val) appSecretObj[s.key] = val;\n        });\n    }\n\n    // Auto-inject DB Connection info into APP Secrets if DB is enabled\n    if (data.dbType !== 'none') {\n        const dbPort = data.dbType === 'postgres' ? \"5432\" : \"3306\";\n        const dbName = data.appName.replace(/-/g, '_'); \n        \n        // Default Connection Vars\n        if (!appSecretObj[\"DB_HOST\"]) appSecretObj[\"DB_HOST\"] = `${data.appName}`;\n        if (!appSecretObj[\"DB_PORT\"]) appSecretObj[\"DB_PORT\"] = dbPort;\n        if (!appSecretObj[\"DB_NAME\"]) appSecretObj[\"DB_NAME\"] = dbName;\n        if (!appSecretObj[\"DB_USER\"]) appSecretObj[\"DB_USER\"] = \"admin\";\n        if (!appSecretObj[\"DB_PASSWORD\"]) appSecretObj[\"DB_PASSWORD\"] = \"changeme_securely\";\n    }\n\n    // --- DB SECRETS Construction ---\n    const dbSecretObj = {};\n    if (data.dbSecrets && Array.isArray(data.dbSecrets)) {\n        data.dbSecrets.forEach(s => {\n             let val = s.value;\n             if (env === 'prod' && s.valueProd) val = s.valueProd;\n             if (env === 'testing' && s.valueTest) val = s.valueTest;\n             \n             // Ensure we treat whitespace-only strings as empty so defaults kick in\n             if (val && typeof val === 'string') {\n                 val = val.trim();\n             }\n\n             if (s.key && val) dbSecretObj[s.key] = val;\n        });\n    }\n    \n    // Auto-inject Defaults for DB Container if DB is enabled\n    if (data.dbType !== 'none') {\n         const dbName = data.appName.replace(/-/g, '_'); \n         if (data.dbType === 'postgres') {\n            if (!dbSecretObj[\"POSTGRES_DB\"]) dbSecretObj[\"POSTGRES_DB\"] = dbName;\n            if (!dbSecretObj[\"POSTGRES_USER\"]) dbSecretObj[\"POSTGRES_USER\"] = \"admin\";\n            if (!dbSecretObj[\"POSTGRES_PASSWORD\"]) dbSecretObj[\"POSTGRES_PASSWORD\"] = \"changeme_securely\";\n         } else {\n            if (!dbSecretObj[\"MYSQL_DATABASE\"]) dbSecretObj[\"MYSQL_DATABASE\"] = dbName;\n            if (!dbSecretObj[\"MYSQL_USER\"]) dbSecretObj[\"MYSQL_USER\"] = \"admin\";\n            if (!dbSecretObj[\"MYSQL_PASSWORD\"]) dbSecretObj[\"MYSQL_PASSWORD\"] = \"changeme_securely\";\n            if (!dbSecretObj[\"MYSQL_ROOT_PASSWORD\"]) dbSecretObj[\"MYSQL_ROOT_PASSWORD\"] = \"changeme_root\";\n         }\n    }\n\n\n    // --- TEMPLATE LOGIC ---\n    // Helper to format secrets safely\n    const formatSecrets = (obj) => {\n        if (Object.keys(obj).length === 0) return '{}';\n        return Object.entries(obj)\n            .map(([k, v]) => {\n                // Escape double quotes and backslashes\n                const safeVal = String(v).replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n                return `  ${k}: \"${safeVal}\"`;\n            })\n            .join('\\n');\n    };\n\n    // A. APP PRODUCTION\n    if (templateType === 'app-prod') {\n        const secretYamlLines = formatSecrets(appSecretObj);\n\n        let yaml = `\nnamespace: prod\ncontrollerType: Deployment\n\napp:\n  id: \"${appId}\"\n  name: \"${appName}\"\n  env: \"prod\"\n\nimage:\n  repository: \"${safeImageRepo}\"\n  tag: \"${data.imageTag}\"\n\nservice:\n  port: ${data.servicePort}\n  targetPort: ${data.targetPort}\n\nsecretData:\n${secretYamlLines}\n`.trim();\n\n        if (data.dbType !== 'none') {\n            yaml += `\\n\\nbackup:\\n  enabled: true\\n  type: \"${data.dbType}\"`;\n        }\n\n        if (data.ingressEnabled) {\n            yaml += `\\n\\ningress:\\n  enabled: true\\n  className: \"nginx\"\\n  hosts:\\n    - host: \"${data.ingressHost}\"\\n      path: /`;\n            if (data.tlsEnabled) {\n                yaml += `\\n  tls:\\n    - secretName: \"${appName}-tls\"\\n      hosts:\\n        - \"${data.ingressHost}\"`;\n            }\n        }\n        return yaml;\n    }\n\n    // B. APP TESTING\n    if (templateType === 'app-testing') {\n        const secretYamlLines = formatSecrets(appSecretObj);\n\n        let yaml = `\nnamespace: testing\ncontrollerType: Deployment\n\napp:\n  id: \"${appId}\"\n  name: \"${appName}\"\n  env: \"testing\"\n\nimage:\n  repository: \"${data.imageRepo}\"\n  tag: \"${data.imageTag}\"\n\nservice:\n  port: ${data.servicePort}\n  targetPort: ${data.targetPort}\n\nsecretData:\n${secretYamlLines}\n`.trim();\n\n        if (data.ingressEnabled) {\n            yaml += `\\n\\ningress:\\n  enabled: true\\n  className: \"nginx\"\\n  hosts:\\n    - host: \"test-${data.ingressHost}\"\\n      path: /`;\n        }\n        return yaml;\n    }\n\n    // C. DB PRODUCTION\n    if (templateType === 'db-prod') {\n        const secretYamlLines = formatSecrets(dbSecretObj);\n\n        const dbImage = data.dbType === 'postgres' ? 'postgres' : 'mariadb';\n        const dbTag = data.dbType === 'postgres' ? '15-alpine' : '10.11'; \n        const dbPort = data.dbType === 'postgres' ? 5432 : 3306;\n\n        let yaml = `\nnamespace: prod\ncontrollerType: StatefulSet\n\napp:\n  id: \"${appId}\"\n  name: \"${appName}-db\"\n  env: \"prod\"\n\nimage:\n  repository: \"${dbImage}\"\n  tag: \"${dbTag}\"\n\nservice:\n  port: ${dbPort}\n  targetPort: ${dbPort}\n\nsecretData:\n${secretYamlLines}\n\nbackup:\n  enabled: true\n  type: \"${data.dbType}\"\n`.trim();\n        return yaml;\n    }\n\n    // D. DB TESTING\n    if (templateType === 'db-testing') {\n        const secretYamlLines = formatSecrets(dbSecretObj);\n\n        const dbImage = data.dbType === 'postgres' ? 'postgres' : 'mariadb';\n        const dbTag = data.dbType === 'postgres' ? '15-alpine' : '10.11';\n        const dbPort = data.dbType === 'postgres' ? 5432 : 3306;\n\n        let yaml = `\nnamespace: testing\ncontrollerType: StatefulSet\n\napp:\n  id: \"${appId}\"\n  name: \"${appName}-db\"\n  env: \"testing\"\n\nimage:\n  repository: \"${dbImage}\"\n  tag: \"${dbTag}\"\n\nservice:\n  port: ${dbPort}\n  targetPort: ${dbPort}\n\nsecretData:\n${secretYamlLines}\n`.trim();\n        return yaml;\n    }\n  };\n\n\n  // --- Helper: Write & Encrypt ---\n  const processManifest = (folderName, type, env) => {\n      const targetFolder = path.join(repoPath, 'apps', folderName);\n      const filePath = path.join(targetFolder, 'values.yaml');\n\n      if (fs.existsSync(targetFolder)) {\n          console.log(`Folder ${folderName} exists, overwriting...`);\n      } else {\n          fs.mkdirSync(targetFolder, { recursive: true });\n      }\n\n      const yamlContent = generateYaml(type, env);\n      fs.writeFileSync(filePath, yamlContent);\n\n      // Encrypt with SOPS\n      try {\n          execSync(`sops --encrypt --age ${ageKey} --encrypted-regex '^(secretData)$' --in-place ${filePath}`, { cwd: repoPath });\n          generatedFolders.push(folderName);\n      } catch (e) {\n          console.error(`Encryption failed for ${folderName}`, e);\n          errors.push(`Encryption failed for ${folderName}: ${e.message}`);\n      }\n  };\n\n\n  try {\n      // 1. App Prod\n      processManifest(`${data.appName}-prod`, 'app-prod', 'prod');\n\n      // 2. App Testing\n      processManifest(`${data.appName}-testing`, 'app-testing', 'testing');\n\n      // 3. DB (if enabled)\n      if (data.dbType !== 'none') {\n          processManifest(`${data.appName}-db-prod`, 'db-prod', 'prod');\n          processManifest(`${data.appName}-db-testing`, 'db-testing', 'testing');\n      }\n\n      // --- 4. Update REGISTRY.JSON ---\n      try {\n          let registry = [];\n          if (fs.existsSync(registryPath)) {\n              const content = fs.readFileSync(registryPath, 'utf8');\n              try { registry = JSON.parse(content); } catch (e) { registry = []; }\n          }\n          \n          // Check if ID already exists, if so update, else append\n          const existingIdx = registry.findIndex(r => r.id === data.appId);\n          const newEntry = {\n              id: data.appId,\n              name: data.appName,\n              image: `${safeImageRepo}:${data.imageTag}`,\n              db: data.dbType,\n              createdAt: new Date().toISOString()\n          };\n\n          if (existingIdx >= 0) {\n              registry[existingIdx] = newEntry;\n          } else {\n              registry.push(newEntry);\n          }\n\n          fs.writeFileSync(registryPath, JSON.stringify(registry, null, 2));\n          console.log(\"Updated registry.json\");\n\n      } catch (regError) {\n          console.error(\"Failed to update registry:\", regError);\n          errors.push(\"Failed to update registry.json: \" + regError.message);\n      }\n\n\n      if (errors.length > 0) {\n          return NextResponse.json({ error: errors.join(', '), generated: generatedFolders }, { status: 400 });\n      }\n\n      if (generatedFolders.length === 0) {\n          return NextResponse.json({ error: \"No manifests were generated.\" }, { status: 400 });\n      }\n\n      // --- Commit & Push ---\n      const commitMsg = `feat: add manifests for ${data.appName} (ID: ${data.appId})`;\n      \n      execSync(`git add .`, { cwd: repoPath });\n      try {\n          execSync(`git commit -m \"${commitMsg}\"`, { cwd: repoPath });\n          execSync(`git push origin main`, { cwd: repoPath });\n      } catch (e) {\n          if (e.message.includes('nothing to commit')) {\n              return NextResponse.json({ message: \"No changes detected (manifests already match).\" });\n          }\n          throw e;\n      }\n\n      return NextResponse.json({\n          message: `Success! Generated and pushed: ${generatedFolders.join(', ')}`,\n          folders: generatedFolders\n      });\n\n  } catch (err) {\n      console.error(err);\n      return NextResponse.json({ error: err.message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}