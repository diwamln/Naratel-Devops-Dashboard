{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///home/rahan/Magang/cicd/Naratel-Devops-Dashboard/src/app/api/k8s/namespaces/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport * as k8s from '@kubernetes/client-node';\n\nexport async function GET() {\n  try {\n    const kc = new k8s.KubeConfig();\n    \n    // Setup Konfigurasi dari ENV\n    kc.loadFromOptions({\n      clusters: [{\n        name: 'remote-cluster',\n        server: process.env.K8S_API_URL,\n        skipTLSVerify: true, // Sangat penting untuk IP Publik/Self-signed\n      }],\n      users: [{\n        name: 'dashboard-sa',\n        token: process.env.K8S_TOKEN,\n      }],\n      contexts: [{\n        name: 'remote-context',\n        user: 'dashboard-sa',\n        cluster: 'remote-cluster',\n      }],\n      currentContext: 'remote-context',\n    });\n\n    const k8sApi = kc.makeApiClient(k8s.CoreV1Api);\n\n    // Panggil API\n    const res = await k8sApi.listNamespace();\n\n    // DEBUGGING: Cek di console terminal Next.js apa isi 'res' sebenarnya\n    // console.log(\"Raw Response:\", res);\n\n    // Ambil data dengan proteksi (Optional Chaining)\n    // Beberapa versi library mengembalikan data langsung di 'res', \n    // beberapa di 'res.body'\n    const items = res.body?.items || res.items || [];\n\n    if (items.length === 0 && !res.body) {\n       throw new Error(\"API berhasil dipanggil tapi tidak ada data (Response Body kosong)\");\n    }\n\n    const namespaces = items.map(ns => ns.metadata.name);\n    namespaces.sort();\n\n    return NextResponse.json({\n      success: true,\n      namespaces: namespaces,\n      count: namespaces.length\n    });\n\n  } catch (error) {\n    // Log error lebih detail agar kita tahu penyebab 'undefined' tadi\n    console.error('--- K8S API ERROR START ---');\n    if (error.response) {\n      // Ini jika server K8s merespon dengan error (401, 403, dll)\n      console.error('Status:', error.response.statusCode);\n      console.error('Body:', error.response.body);\n    } else {\n      // Ini jika ada error koneksi atau code error\n      console.error('Message:', error.message);\n    }\n    console.error('--- K8S API ERROR END ---');\n\n    return NextResponse.json({\n      success: false,\n      message: `Gagal fetch namespace: ${error.message}`,\n      // Kirim status code asli dari K8s jika ada\n      status: error.response?.statusCode || 500\n    }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AAAA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,IAAI,gLAAc;QAE7B,6BAA6B;QAC7B,GAAG,eAAe,CAAC;YACjB,UAAU;gBAAC;oBACT,MAAM;oBACN,QAAQ,QAAQ,GAAG,CAAC,WAAW;oBAC/B,eAAe;gBACjB;aAAE;YACF,OAAO;gBAAC;oBACN,MAAM;oBACN,OAAO,QAAQ,GAAG,CAAC,SAAS;gBAC9B;aAAE;YACF,UAAU;gBAAC;oBACT,MAAM;oBACN,MAAM;oBACN,SAAS;gBACX;aAAE;YACF,gBAAgB;QAClB;QAEA,MAAM,SAAS,GAAG,aAAa,CAAC,qLAAa;QAE7C,cAAc;QACd,MAAM,MAAM,MAAM,OAAO,aAAa;QAEtC,sEAAsE;QACtE,qCAAqC;QAErC,iDAAiD;QACjD,gEAAgE;QAChE,yBAAyB;QACzB,MAAM,QAAQ,IAAI,IAAI,EAAE,SAAS,IAAI,KAAK,IAAI,EAAE;QAEhD,IAAI,MAAM,MAAM,KAAK,KAAK,CAAC,IAAI,IAAI,EAAE;YAClC,MAAM,IAAI,MAAM;QACnB;QAEA,MAAM,aAAa,MAAM,GAAG,CAAC,CAAA,KAAM,GAAG,QAAQ,CAAC,IAAI;QACnD,WAAW,IAAI;QAEf,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,YAAY;YACZ,OAAO,WAAW,MAAM;QAC1B;IAEF,EAAE,OAAO,OAAO;QACd,kEAAkE;QAClE,QAAQ,KAAK,CAAC;QACd,IAAI,MAAM,QAAQ,EAAE;YAClB,4DAA4D;YAC5D,QAAQ,KAAK,CAAC,WAAW,MAAM,QAAQ,CAAC,UAAU;YAClD,QAAQ,KAAK,CAAC,SAAS,MAAM,QAAQ,CAAC,IAAI;QAC5C,OAAO;YACL,6CAA6C;YAC7C,QAAQ,KAAK,CAAC,YAAY,MAAM,OAAO;QACzC;QACA,QAAQ,KAAK,CAAC;QAEd,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS,CAAC,uBAAuB,EAAE,MAAM,OAAO,EAAE;YAClD,2CAA2C;YAC3C,QAAQ,MAAM,QAAQ,EAAE,cAAc;QACxC,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}