module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},33405,(e,t,r)=>{t.exports=e.x("child_process",()=>require("child_process"))},45559,e=>{"use strict";Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let t=Error("request for lock canceled");class r{constructor(e,r=t){this._value=e,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((r,i)=>{let n={resolve:r,reject:i,weight:e,priority:t},a=s(this._queue,e=>t<=e.priority);-1===a&&e<=this._value?this._dispatchItem(n):this._queue.splice(a+1,0,n)})}runExclusive(e){var t,r,s,i;return t=this,r=arguments,s=void 0,i=function*(e,t=1,r=0){let[s,i]=yield this.acquire(t,r);try{return yield e(s)}finally{i()}},new(s||(s=Promise))(function(e,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(t){var r;t.done?e(t.value):((r=t.value)instanceof s?r:new s(function(e){e(r)})).then(a,o)}l((i=i.apply(t,r||[])).next())})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{var i,n;let a;this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),i=this._weightedWaiters[e-1],n={resolve:r,priority:t},a=s(i,e=>n.priority<=e.priority),i.splice(a+1,0,n)})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let r=this._weightedWaiters[t-1];if(!r)continue;let s=r.findIndex(t=>t.priority<=e);(-1===s?r:r.splice(0,s)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function s(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}let i=new class{constructor(e){this._semaphore=new r(1,e)}acquire(){var e,t,r,s;return e=this,t=arguments,r=void 0,s=function*(e=0){let[,t]=yield this._semaphore.acquire(1,e);return t},new(r||(r=Promise))(function(i,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((s=s.apply(e,t||[])).next())})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};e.s(["gitMutex",0,i],45559)},20129,e=>{"use strict";var t=e.i(47839),r=e.i(77588),s=e.i(240),i=e.i(34396),n=e.i(40418),a=e.i(65869),o=e.i(26761),l=e.i(24467),u=e.i(776),c=e.i(58262),d=e.i(97344),p=e.i(66840),h=e.i(75027),f=e.i(41200),g=e.i(80270),x=e.i(87401),m=e.i(93695);e.i(96917);var v=e.i(88273),y=e.i(79425),w=e.i(33405),_=e.i(22734),R=e.i(14747),E=e.i(46786),S=e.i(44550),N=e.i(45559);let b=()=>({repoPath:R.default.join(E.default.tmpdir(),"manifest-repo-workdir"),token:process.env.GITHUB_TOKEN,repoUrl:process.env.MANIFEST_REPO_URL,userName:process.env.GIT_USER_NAME||"Naratel DevOps Dashboard",userEmail:process.env.GIT_USER_EMAIL||"devops@naratel.com"});async function q(e){let{searchParams:t}=new URL(e.url),r=t.get("appName");return r?await N.gitMutex.runExclusive(async()=>{let{repoPath:e,repoUrl:t,token:s,userName:i,userEmail:n}=b(),a=t.replace("https://",`https://${s}@`);try{if(_.default.existsSync(e))try{(0,w.execSync)("git fetch origin",{cwd:e}),(0,w.execSync)("git reset --hard origin/main",{cwd:e})}catch(t){_.default.rmSync(e,{recursive:!0,force:!0}),(0,w.execSync)(`git clone ${a} ${e}`)}else(0,w.execSync)(`git clone ${a} ${e}`);(0,w.execSync)(`git config user.name "${i}"`,{cwd:e}),(0,w.execSync)(`git config user.email "${n}"`,{cwd:e});let t=R.default.join(e,"apps",`${r}-prod`,"values.yaml"),s=(e=>{if(!_.default.existsSync(e))return null;try{let t=_.default.readFileSync(e,"utf8"),r=S.default.load(t).ingress||{},s=r.hosts&&r.hosts[0]?r.hosts[0].host:"";return{enabled:r.enabled||!1,host:s,tls:!!(r.tls&&r.tls.length>0)}}catch(t){return console.error(`Failed to read ${e}:`,t.message),null}})(t);return y.NextResponse.json(s||{enabled:!1,host:"",tls:!1})}catch(e){return console.error(e),y.NextResponse.json({error:e.message},{status:500})}}):y.NextResponse.json({error:"App Name required"},{status:400})}async function k(e){let{appName:t,enabled:r,host:s,tls:i}=await e.json();return t?await N.gitMutex.runExclusive(async()=>{let{repoPath:e,repoUrl:n,token:a,userName:o,userEmail:l}=b(),u=n.replace("https://",`https://${a}@`);try{if(_.default.existsSync(e))try{(0,w.execSync)("git fetch origin",{cwd:e}),(0,w.execSync)("git reset --hard origin/main",{cwd:e})}catch(t){_.default.rmSync(e,{recursive:!0,force:!0}),(0,w.execSync)(`git clone ${u} ${e}`)}else(0,w.execSync)(`git clone ${u} ${e}`);(0,w.execSync)(`git config user.name "${o}"`,{cwd:e}),(0,w.execSync)(`git config user.email "${l}"`,{cwd:e});let n=R.default.join(e,"apps",`${t}-prod`,"values.yaml");R.default.join(e,"apps",`${t}-testing`,"values.yaml"),((e,t,r,s)=>{if(_.default.existsSync(e))try{let i=_.default.readFileSync(e,"utf8"),n=S.default.load(i);if(t.enabled){let e=r?`test-${t.host}`:t.host;n.ingress={enabled:!0,className:"nginx",hosts:[{host:e,path:"/"}]},t.tls?n.ingress.tls=[{secretName:`${s}-tls`,hosts:[e]}]:delete n.ingress.tls}else n.ingress={enabled:!1};let a=S.default.dump(n,{lineWidth:-1});_.default.writeFileSync(e,a)}catch(t){throw Error(`Failed to update ${R.default.basename(e)}: ${t.message}`)}})(n,{enabled:r,host:s,tls:i},!1,t);let a=R.default.join(e,"registry.json");if(_.default.existsSync(a))try{let e=JSON.parse(_.default.readFileSync(a,"utf8")),i=e.findIndex(e=>e.name===t);i>=0&&(e[i].ingressHost=r?s:null,_.default.writeFileSync(a,JSON.stringify(e,null,2)))}catch(e){console.error("Registry sync failed:",e.message)}if((0,w.execSync)("git add .",{cwd:e}),(0,w.execSync)("git status --porcelain",{cwd:e}).toString().trim())return(0,w.execSync)(`git commit -m "chore: update ingress config for ${t}"`,{cwd:e}),(0,w.execSync)("git push origin main",{cwd:e}),y.NextResponse.json({message:"Ingress configuration updated!"});return y.NextResponse.json({message:"No changes detected."})}catch(e){return console.error(e),y.NextResponse.json({error:e.message},{status:500})}}):y.NextResponse.json({error:"Missing App Name"},{status:400})}e.s(["GET",()=>q,"POST",()=>k,"dynamic",0,"force-dynamic"],40282);var C=e.i(40282);let $=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/manifest/ingress/route",pathname:"/api/manifest/ingress",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/webui-devops/Naratel-Devops-Dashboard/src/app/api/manifest/ingress/route.js",nextConfigOutput:"standalone",userland:C}),{workAsyncStorage:A,workUnitAsyncStorage:j,serverHooks:P}=$;function T(){return(0,s.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:j})}async function I(e,t,s){$.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/manifest/ingress/route";y=y.replace(/\/index$/,"")||"/";let w=await $.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:_,params:R,nextConfig:E,parsedUrl:S,isDraftMode:N,prerenderManifest:b,routerServerContext:q,isOnDemandRevalidate:k,revalidateOnlyGenerated:C,resolvedPathname:A,clientReferenceManifest:j,serverActionsManifest:P}=w,T=(0,l.normalizeAppPath)(y),I=!!(b.dynamicRoutes[T]||b.routes[A]),U=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,S,!1):t.end("This page could not be found"),null);if(I&&!N){let e=!!b.routes[A],t=b.dynamicRoutes[T];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await U();throw new m.NoFallbackError}}let O=null;!I||$.isDev||N||(O="/index"===(O=A)?"/":O);let M=!0===$.isDev||!I,F=I&&!M;P&&j&&(0,a.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:j,serverActionsManifest:P,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:P})});let H=e.method||"GET",D=(0,n.getTracer)(),L=D.getActiveScopeSpan(),W={params:R,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>$.onRequestError(e,t,s,q)},sharedContext:{buildId:_}},K=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let a=async e=>$.handle(B,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=D.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${H} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${y}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&k&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(i);e.fetchMetrics=W.renderOpts.fetchMetrics;let l=W.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let u=W.renderOpts.collectedTags;if(!I)return await (0,h.sendResponse)(K,G,n,W.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[x.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,s=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await $.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:k})},q),t}},c=await $.handleResponse({req:e,nextConfig:E,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:o});if(!I)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",k?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&I||d.delete(x.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(K,G,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};L?await l(L):await D.withPropagatedContext(e.headers,()=>D.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${y}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof m.NoFallbackError||await $.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:k})}),I)throw t;return await (0,h.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>T,"routeModule",()=>$,"serverHooks",()=>P,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>j],20129)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ab8d7dc5._.js.map